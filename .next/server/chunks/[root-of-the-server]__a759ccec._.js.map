{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/EQUIPO%202/whatsapp-clean/src/app/api/marketing/insights/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\n\r\ninterface Metric {\r\n  dateStart: string;\r\n  dateStop: string;\r\n  spend: number;\r\n  impressions: number;\r\n  reach: number;\r\n  clicks: number;\r\n  uniqueClicks: number;\r\n  cpc: number;\r\n  ctr: number;\r\n  frequency: number;\r\n  campaignName: string;\r\n  adsetName: string;\r\n  adName: string;\r\n  effectiveStatus: string;\r\n  actions: { actionType: string; value: number }[];\r\n}\r\n\r\nexport async function GET(request: Request) { \r\n  const { searchParams } = new URL(request.url);\r\n  const limit = searchParams.get('limit') || '20';  // Por defecto 10 campañas\r\n  const after = searchParams.get('after') || '';    // Cursor para paginación\r\n\r\n  try {\r\n    const url = `https://graph.facebook.com/v17.0/act_${process.env.FACEBOOK_AD_ACCOUNT_ID}/insights` +\r\n      `?fields=date_start,date_stop,spend,impressions,reach,clicks,unique_clicks,cpc,ctr,frequency,campaign_name,adset_name,ad_name,actions` +\r\n      `&level=ad` +\r\n      `&limit=${limit}` +\r\n      `&access_token=${process.env.FACEBOOK_ACCESS_TOKEN}` +\r\n      (after ? `&after=${after}` : '');\r\n\r\n    const response = await fetch(url, { method: 'GET' });\r\n\r\n    console.log('Status Code:', response.status);\r\n\r\n    if (!response.ok) {\r\n      const errorMessage = await response.json();\r\n      console.log('Error Message:', errorMessage);\r\n      return NextResponse.json({ error: errorMessage.error.message }, { status: 500 });\r\n    }\r\n\r\n    const data = await response.json();\r\n    console.log('Datos recibidos:', data);\r\n\r\n    const formattedData: Metric[] = data.data.map((entry: any) => ({\r\n      dateStart: entry.date_start || 'N/A',\r\n      dateStop: entry.date_stop || 'N/A',\r\n      spend: parseFloat(entry.spend) || 0,\r\n      impressions: parseInt(entry.impressions) || 0,\r\n      reach: parseInt(entry.reach) || 0,\r\n      clicks: parseInt(entry.clicks) || 0,\r\n      uniqueClicks: parseInt(entry.unique_clicks) || 0,\r\n      cpc: parseFloat(entry.cpc) || 0,\r\n      ctr: parseFloat(entry.ctr) || 0,\r\n      frequency: parseFloat(entry.frequency) || 0,\r\n      campaignName: entry.campaign_name || 'N/A',\r\n      adsetName: entry.adset_name || 'N/A',\r\n      adName: entry.ad_name || 'N/A',\r\n      effectiveStatus: entry.effective_status || 'N/A',\r\n      actions: entry.actions ? entry.actions.map((action: any) => ({\r\n        actionType: action.action_type || 'N/A',\r\n        value: parseInt(action.value) || 0,\r\n      })) : []\r\n    }));\r\n\r\n    return NextResponse.json({ data: formattedData, paging: data.paging });\r\n  } catch (error: any) {\r\n    console.error('Error interno:', error.message || error);\r\n    return NextResponse.json({ error: error.message || 'Error desconocido' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;;AAoBO,eAAe,IAAI,OAAgB;IACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC,YAAY,MAAO,0BAA0B;IAC5E,MAAM,QAAQ,aAAa,GAAG,CAAC,YAAY,IAAO,yBAAyB;IAE3E,IAAI;QACF,MAAM,MAAM,CAAC,qCAAqC,EAAE,QAAQ,GAAG,CAAC,sBAAsB,CAAC,SAAS,CAAC,GAC/F,CAAC,oIAAoI,CAAC,GACtI,CAAC,SAAS,CAAC,GACX,CAAC,OAAO,EAAE,OAAO,GACjB,CAAC,cAAc,EAAE,QAAQ,GAAG,CAAC,qBAAqB,EAAE,GACpD,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,GAAG,EAAE;QAEjC,MAAM,WAAW,MAAM,MAAM,KAAK;YAAE,QAAQ;QAAM;QAElD,QAAQ,GAAG,CAAC,gBAAgB,SAAS,MAAM;QAE3C,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,eAAe,MAAM,SAAS,IAAI;YACxC,QAAQ,GAAG,CAAC,kBAAkB;YAC9B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,aAAa,KAAK,CAAC,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,QAAQ,GAAG,CAAC,oBAAoB;QAEhC,MAAM,gBAA0B,KAAK,IAAI,CAAC,GAAG,CAAC,CAAC,QAAe,CAAC;gBAC7D,WAAW,MAAM,UAAU,IAAI;gBAC/B,UAAU,MAAM,SAAS,IAAI;gBAC7B,OAAO,WAAW,MAAM,KAAK,KAAK;gBAClC,aAAa,SAAS,MAAM,WAAW,KAAK;gBAC5C,OAAO,SAAS,MAAM,KAAK,KAAK;gBAChC,QAAQ,SAAS,MAAM,MAAM,KAAK;gBAClC,cAAc,SAAS,MAAM,aAAa,KAAK;gBAC/C,KAAK,WAAW,MAAM,GAAG,KAAK;gBAC9B,KAAK,WAAW,MAAM,GAAG,KAAK;gBAC9B,WAAW,WAAW,MAAM,SAAS,KAAK;gBAC1C,cAAc,MAAM,aAAa,IAAI;gBACrC,WAAW,MAAM,UAAU,IAAI;gBAC/B,QAAQ,MAAM,OAAO,IAAI;gBACzB,iBAAiB,MAAM,gBAAgB,IAAI;gBAC3C,SAAS,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC,SAAgB,CAAC;wBAC3D,YAAY,OAAO,WAAW,IAAI;wBAClC,OAAO,SAAS,OAAO,KAAK,KAAK;oBACnC,CAAC,KAAK,EAAE;YACV,CAAC;QAED,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,MAAM;YAAe,QAAQ,KAAK,MAAM;QAAC;IACtE,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,kBAAkB,MAAM,OAAO,IAAI;QACjD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAoB,GAAG;YAAE,QAAQ;QAAI;IAC1F;AACF","debugId":null}}]
}