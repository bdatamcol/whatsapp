{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/EQUIPO%202/whatsapp-clean/src/app/api/marketing/account/route.ts"],"sourcesContent":["// app/api/marketing/account/route.ts\r\nimport { NextResponse } from 'next/server';\r\n\r\nexport const dynamic = 'force-dynamic'\r\nexport async function GET() {\r\n  const accessToken = process.env.FACEBOOK_ACCESS_TOKEN;\r\n  const accountId = process.env.MARKETING_ACCOUNT_ID;\r\n  const version = process.env.META_API_VERSION || 'v17.0';\r\n\r\n  if (!accessToken || !accountId) {\r\n    return NextResponse.json({ ok: false, error: 'Faltan credenciales' }, { status: 400 });\r\n  }\r\n\r\n  try {\r\n    // Obtener datos del Ad Account\r\n    const accountRes = await fetch(\r\n      `https://graph.facebook.com/${version}/${accountId}?fields=name,account_status&access_token=${accessToken}`\r\n    );\r\n    const accountData = await accountRes.json();\r\n\r\n    // Obtener lista de páginas asociadas\r\n    // Modificar el fetch de páginas para incluir force_token\r\nconst pagesRes = await fetch(\r\n  `https://graph.facebook.com/${version}/me/accounts?fields=id,name,category,username,access_token&access_token=${accessToken}&force_token=page`\r\n);\r\n    const pagesList = await pagesRes.json();\r\n\r\n    if (!pagesList?.data) {\r\n      return NextResponse.json({ ok: false, error: 'No se encontraron páginas' }, { status: 404 });\r\n    }\r\n\r\n    // Para cada página, obtener detalles con su Page Access Token\r\n    const detailedPages = await Promise.all(\r\n      pagesList.data.map(async (page: FacebookPage) => {\r\n\r\n              if (!page.access_token) return page;\r\n\r\n        try {\r\n          const detailRes = await fetch(\r\n            `https://graph.facebook.com/${version}/${page.id}?fields=fan_count&access_token=${page.access_token}`\r\n          );\r\n          const detailData = await detailRes.json();\r\n\r\n          // Agregar en el return de detailedPages\r\nreturn {\r\n  ...page,\r\n  fan_count: detailData?.fan_count ?? 0,\r\n  access_token: page.access_token.substring(0, 15) + '...' // Solo para debug\r\n};\r\n          \r\n        } catch (err) {\r\n          console.error(`Error obteniendo fan_count para ${page.name}`, err);\r\n          return page;\r\n        }\r\n      })\r\n    );\r\n\r\n    // app/api/marketing/account/route.ts\r\n// ... (código existente)\r\n\r\nreturn NextResponse.json({\r\n  ok: true,\r\n  account: accountData,\r\n  pages: detailedPages.map(page => ({\r\n    id: page.id,\r\n    name: page.name,\r\n    category: page.category,\r\n    username: page.username,\r\n    fan_count: page.fan_count,\r\n    access_token: page.access_token // Asegurarnos que se incluye\r\n  }))\r\n});\r\n\r\ntype FacebookPage = {\r\n  id: string;\r\n  name: string;\r\n  category?: string;\r\n  username?: string;\r\n  access_token?: string;\r\n  fan_count?: number;\r\n};\r\n\r\n  } catch (error) {\r\n    console.error('Error al obtener datos del marketing account:', error);\r\n    return NextResponse.json({ ok: false, error: 'Error interno del servidor' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,qCAAqC;;;;;AACrC;;AAEO,MAAM,UAAU;AAChB,eAAe;IACpB,MAAM,cAAc,QAAQ,GAAG,CAAC,qBAAqB;IACrD,MAAM,YAAY,QAAQ,GAAG,CAAC,oBAAoB;IAClD,MAAM,UAAU,QAAQ,GAAG,CAAC,gBAAgB,IAAI;IAEhD,IAAI,CAAC,eAAe,CAAC,WAAW;QAC9B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;IACtF;IAEA,IAAI;QACF,+BAA+B;QAC/B,MAAM,aAAa,MAAM,MACvB,CAAC,2BAA2B,EAAE,QAAQ,CAAC,EAAE,UAAU,yCAAyC,EAAE,aAAa;QAE7G,MAAM,cAAc,MAAM,WAAW,IAAI;QAEzC,qCAAqC;QACrC,yDAAyD;QAC7D,MAAM,WAAW,MAAM,MACrB,CAAC,2BAA2B,EAAE,QAAQ,wEAAwE,EAAE,YAAY,iBAAiB,CAAC;QAE5I,MAAM,YAAY,MAAM,SAAS,IAAI;QAErC,IAAI,CAAC,WAAW,MAAM;YACpB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,8DAA8D;QAC9D,MAAM,gBAAgB,MAAM,QAAQ,GAAG,CACrC,UAAU,IAAI,CAAC,GAAG,CAAC,OAAO;YAElB,IAAI,CAAC,KAAK,YAAY,EAAE,OAAO;YAErC,IAAI;gBACF,MAAM,YAAY,MAAM,MACtB,CAAC,2BAA2B,EAAE,QAAQ,CAAC,EAAE,KAAK,EAAE,CAAC,+BAA+B,EAAE,KAAK,YAAY,EAAE;gBAEvG,MAAM,aAAa,MAAM,UAAU,IAAI;gBAEvC,wCAAwC;gBAClD,OAAO;oBACL,GAAG,IAAI;oBACP,WAAW,YAAY,aAAa;oBACpC,cAAc,KAAK,YAAY,CAAC,SAAS,CAAC,GAAG,MAAM,MAAM,kBAAkB;gBAC7E;YAEQ,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE,EAAE;gBAC9D,OAAO;YACT;QACF;QAGF,qCAAqC;QACzC,yBAAyB;QAEzB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,IAAI;YACJ,SAAS;YACT,OAAO,cAAc,GAAG,CAAC,CAAA,OAAQ,CAAC;oBAChC,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,IAAI;oBACf,UAAU,KAAK,QAAQ;oBACvB,UAAU,KAAK,QAAQ;oBACvB,WAAW,KAAK,SAAS;oBACzB,cAAc,KAAK,YAAY,CAAC,6BAA6B;gBAC/D,CAAC;QACH;IAWE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iDAAiD;QAC/D,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAC7F;AACF","debugId":null}}]
}