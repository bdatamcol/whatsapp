{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/EQUIPO%202/whatsapp-clean/src/lib/whatsapp/whatsapp.client.ts"],"sourcesContent":["'use strict';\r\n\r\nimport { Contact } from \"@/types/whatsapp\";\r\n\r\nconst API_VERSION = 'v19.0';\r\n\r\nexport default class WhatsAppClient {\r\n  private readonly baseUrl: string;\r\n\r\n  constructor() {\r\n    if (!process.env.WHATSAPP_PHONE_NUMBER_ID) {\r\n      throw new Error('Missing WHATSAPP_PHONE_NUMBER_ID in environment');\r\n    }\r\n    this.baseUrl = `https://graph.facebook.com/${API_VERSION}/${process.env.WHATSAPP_PHONE_NUMBER_ID}`;\r\n  }\r\n\r\n  // src/lib/whatsapp/whatsapp.client.ts\r\nasync getContacts(): Promise<Contact[]> {\r\n  try {\r\n    // En producciÃ³n, aquÃ­ llamarÃ­as a la API de WhatsApp/Meta\r\n    // Pero para desarrollo, podemos simular datos o conectar a una DB\r\n    const mockContacts: Contact[] = [\r\n      {\r\n        id: \"521234567890\",\r\n        name: \"Cliente Ejemplo\",\r\n        lastMessage: \"Hola, Â¿cÃ³mo estÃ¡s?\",\r\n        unread: 2,\r\n        lastMessageTime: new Date()\r\n      }\r\n    ];\r\n    return mockContacts;\r\n    \r\n    // Para conexiÃ³n real con WhatsApp API (descomentar cuando estÃ© listo):\r\n    // const response = await fetch(`${this.baseUrl}/contacts`, {\r\n    //   headers: this.getHeaders()\r\n    // });\r\n    // return await this.handleResponse(response);\r\n  } catch (error) {\r\n    console.error('Error fetching contacts:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n  async sendText(to: string, message: string) {\r\n    const response = await fetch(`${this.baseUrl}/messages`, {\r\n      method: 'POST',\r\n      headers: this.getHeaders(),\r\n      body: JSON.stringify({\r\n        messaging_product: \"whatsapp\",\r\n        recipient_type: \"individual\",\r\n        to: to,\r\n        text: { body: message }\r\n      }),\r\n    });\r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  private getHeaders() {\r\n    if (!process.env.WHATSAPP_ACCESS_TOKEN) {\r\n      throw new Error('Missing WHATSAPP_ACCESS_TOKEN in environment');\r\n    }\r\n    return {\r\n      'Authorization': `Bearer ${process.env.WHATSAPP_ACCESS_TOKEN}`,\r\n      'Content-Type': 'application/json',\r\n    };\r\n  }\r\n\r\n  private async handleResponse(response: Response) {\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      console.error('WhatsApp API Error:', error);\r\n      throw new Error(error.error?.message || 'WhatsApp API error');\r\n    }\r\n    return response.json();\r\n  }\r\n}\r\n// ðŸ”¥ Nada mÃ¡s despuÃ©s de aquÃ­. Â¡No mÃ¡s module.exports!\r\n"],"names":[],"mappings":";;;AAAA;AAIA,MAAM,cAAc;AAEL,MAAM;IACF,QAAgB;IAEjC,aAAc;QACZ,uCAA2C;;QAE3C;QACA,IAAI,CAAC,OAAO,GAAG,CAAC,2BAA2B,EAAE,YAAY,CAAC,kDAAwC;IACpG;IAEA,sCAAsC;IACxC,MAAM,cAAkC;QACtC,IAAI;YACF,0DAA0D;YAC1D,kEAAkE;YAClE,MAAM,eAA0B;gBAC9B;oBACE,IAAI;oBACJ,MAAM;oBACN,aAAa;oBACb,QAAQ;oBACR,iBAAiB,IAAI;gBACvB;aACD;YACD,OAAO;QAEP,uEAAuE;QACvE,6DAA6D;QAC7D,+BAA+B;QAC/B,MAAM;QACN,8CAA8C;QAChD,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,MAAM;QACR;IACF;IAEE,MAAM,SAAS,EAAU,EAAE,OAAe,EAAE;QAC1C,MAAM,WAAW,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;YACvD,QAAQ;YACR,SAAS,IAAI,CAAC,UAAU;YACxB,MAAM,KAAK,SAAS,CAAC;gBACnB,mBAAmB;gBACnB,gBAAgB;gBAChB,IAAI;gBACJ,MAAM;oBAAE,MAAM;gBAAQ;YACxB;QACF;QACA,OAAO,IAAI,CAAC,cAAc,CAAC;IAC7B;IAEQ,aAAa;QACnB,uCAAwC;;QAExC;QACA,OAAO;YACL,iBAAiB,CAAC,OAAO,wQAAqC;YAC9D,gBAAgB;QAClB;IACF;IAEA,MAAc,eAAe,QAAkB,EAAE;QAC/C,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,QAAQ,MAAM,SAAS,IAAI;YACjC,QAAQ,KAAK,CAAC,uBAAuB;YACrC,MAAM,IAAI,MAAM,MAAM,KAAK,EAAE,WAAW;QAC1C;QACA,OAAO,SAAS,IAAI;IACtB;AACF,EACA,uDAAuD","debugId":null}},
    {"offset": {"line": 212, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/EQUIPO%202/whatsapp-clean/src/app/providers/WhatsAppProvider.tsx"],"sourcesContent":["// app/providers/WhatsAppProvider.tsx\r\n'use client';\r\n\r\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\r\nimport WhatsAppClient from '@/lib/whatsapp/whatsapp.client';\r\nimport { Contact, Message } from '@/types/whatsapp.d';\r\nimport io  from 'socket.io-client';\r\n\r\ninterface WhatsAppState {\r\n  contacts: Contact[];\r\n  messages: Message[];\r\n  selectedContact: string | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n}\r\n\r\ninterface WhatsAppContextType extends WhatsAppState {\r\n  selectContact: (phone: string) => Promise<void>;\r\n  sendMessage: (message: string) => Promise<void>;\r\n  refreshContacts: () => Promise<void>;\r\n  loadMoreMessages: () => Promise<void>;\r\n}\r\n\r\nconst WhatsAppContext = createContext<WhatsAppContextType | undefined>(undefined);\r\n\r\nexport const WhatsAppProvider = ({ children }: { children: React.ReactNode }) => {\r\n  const [state, setState] = useState<WhatsAppState>({\r\n    contacts: [],\r\n    messages: [],\r\n    selectedContact: null,\r\n    loading: false,\r\n    error: null,\r\n  });\r\n\r\n  const whatsapp = new WhatsAppClient();\r\n\r\n  // ConexiÃ³n con Socket.io para actualizaciÃ³n en tiempo real\r\n  useEffect(() => {\r\n    const socket = io(process.env.NEXT_PUBLIC_SOCKET_URL || 'http://localhost:3001');\r\n    \r\n    socket.on('newMessage', (newMessage) => {\r\n      setState(prev => ({\r\n        ...prev,\r\n        messages: [...prev.messages, newMessage]\r\n      }));\r\n    });\r\n\r\n    return () => {\r\n      socket.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  const loadContacts = useCallback(async () => {\r\n    setState(prev => ({ ...prev, loading: true, error: null }));\r\n    try {\r\n      const response = await fetch('/api/whatsapp/contacts');\r\n      if (!response.ok) throw new Error('Error al cargar contactos');\r\n      const contacts: Contact[] = await response.json();\r\n      setState(prev => ({ ...prev, contacts, loading: false }));\r\n    } catch (error) {\r\n      setState(prev => ({ ...prev, error: 'Error al cargar contactos', loading: false }));\r\n    }\r\n  }, []);\r\n\r\n  const sendMessage = useCallback(async (message: string) => {\r\n    if (!state.selectedContact || !message.trim()) return;\r\n    setState(prev => ({ ...prev, loading: true, error: null }));\r\n    try {\r\n      await whatsapp.sendText(state.selectedContact, message);\r\n      \r\n      const newMsg: Message = {\r\n        id: Date.now().toString(),\r\n        text: message,\r\n        timestamp: new Date().toISOString(),\r\n        direction: 'outbound',\r\n        status: 'sent'\r\n      };\r\n      \r\n      setState(prev => ({\r\n        ...prev,\r\n        messages: [...prev.messages, newMsg],\r\n        loading: false\r\n      }));\r\n    } catch (error) {\r\n      setState(prev => ({ ...prev, error: 'Error al enviar mensaje', loading: false }));\r\n    }\r\n  }, [state.selectedContact]);\r\n\r\n  const selectContact = useCallback(async (phone: string) => {\r\n    setState(prev => ({ ...prev, selectedContact: phone, loading: true, error: null }));\r\n    try {\r\n      const response = await fetch(`/api/whatsapp/messages?contact=${phone}`);\r\n      if (!response.ok) throw new Error('Error al cargar mensajes');\r\n      const messages: Message[] = await response.json();\r\n      setState(prev => ({ ...prev, messages, loading: false }));\r\n    } catch (error) {\r\n      setState(prev => ({ ...prev, error: 'Error al cargar mensajes', loading: false }));\r\n    }\r\n  }, []);\r\n\r\n  const loadMoreMessages = useCallback(async () => {\r\n    if (!state.selectedContact) return;\r\n    setState(prev => ({ ...prev, loading: true, error: null }));\r\n    try {\r\n      const oldestMessage = state.messages[0];\r\n      const response = await fetch(\r\n        `/api/whatsapp/messages?contact=${state.selectedContact}&before=${oldestMessage.timestamp}`\r\n      );\r\n      const olderMessages: Message[] = await response.json();\r\n      setState(prev => ({\r\n        ...prev,\r\n        messages: [...olderMessages, ...prev.messages],\r\n        loading: false\r\n      }));\r\n    } catch (error) {\r\n      setState(prev => ({ ...prev, error: 'Error al cargar mÃ¡s mensajes', loading: false }));\r\n    }\r\n  }, [state.selectedContact, state.messages]);\r\n\r\n  useEffect(() => {\r\n    loadContacts();\r\n  }, [loadContacts]);\r\n\r\n  return (\r\n    <WhatsAppContext.Provider\r\n      value={{\r\n        ...state,\r\n        selectContact,\r\n        sendMessage,\r\n        refreshContacts: loadContacts,\r\n        loadMoreMessages\r\n      }}\r\n    >\r\n      {children}\r\n    </WhatsAppContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useWhatsApp = (): WhatsAppContextType => {\r\n  const context = useContext(WhatsAppContext);\r\n  if (!context) {\r\n    throw new Error('useWhatsApp debe usarse dentro de WhatsAppProvider');\r\n  }\r\n  return context;\r\n};"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 397, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/EQUIPO%202/whatsapp-clean/src/app/providers/Providers.tsx"],"sourcesContent":["'use client'; // Solo este archivo es cliente\r\n\r\nimport { WhatsAppProvider } from '@/app/providers/WhatsAppProvider'; // CORREGIDO: sin /app\r\n\r\nexport function Providers({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <WhatsAppProvider>\r\n      {children}\r\n    </WhatsAppProvider>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA,uPAAqE,sBAAsB;AAF3F,cAAc,+BAA+B;;;AAItC,SAAS,UAAU,EAAE,QAAQ,EAAiC;IACnE,qBACE,8OAAC,4IAAA,CAAA,mBAAgB;kBACd;;;;;;AAGP","debugId":null}}]
}