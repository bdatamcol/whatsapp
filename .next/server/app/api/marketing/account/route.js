(()=>{var e={};e.id=458,e.ids=[458],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},39566:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>p,serverHooks:()=>k,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var a={};r.r(a),r.d(a,{GET:()=>u,dynamic:()=>i});var s=r(96559),n=r(48088),o=r(37719),c=r(32190);let i="force-dynamic";async function u(){let e=process.env.FACEBOOK_ACCESS_TOKEN,t=process.env.MARKETING_ACCOUNT_ID,r=process.env.META_API_VERSION||"v17.0";if(!e||!t)return c.NextResponse.json({ok:!1,error:"Faltan credenciales"},{status:400});try{let a=await fetch(`https://graph.facebook.com/${r}/${t}?fields=name,account_status&access_token=${e}`),s=await a.json(),n=await fetch(`https://graph.facebook.com/${r}/me/accounts?fields=id,name,category,username,access_token&access_token=${e}&force_token=page`),o=await n.json();if(!o?.data)return c.NextResponse.json({ok:!1,error:"No se encontraron p\xe1ginas"},{status:404});let i=await Promise.all(o.data.map(async e=>{if(!e.access_token)return e;try{let t=await fetch(`https://graph.facebook.com/${r}/${e.id}?fields=fan_count&access_token=${e.access_token}`),a=await t.json();return{...e,fan_count:a?.fan_count??0,access_token:e.access_token.substring(0,15)+"..."}}catch(t){return console.error(`Error obteniendo fan_count para ${e.name}`,t),e}}));return c.NextResponse.json({ok:!0,account:s,pages:i.map(e=>({id:e.id,name:e.name,category:e.category,username:e.username,fan_count:e.fan_count,access_token:e.access_token}))})}catch(e){return console.error("Error al obtener datos del marketing account:",e),c.NextResponse.json({ok:!1,error:"Error interno del servidor"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/marketing/account/route",pathname:"/api/marketing/account",filename:"route",bundlePath:"app/api/marketing/account/route"},resolvedPagePath:"C:\\Users\\EQUIPO 2\\whatsapp-clean\\src\\app\\api\\marketing\\account\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:k}=p;function m(){return(0,o.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[719,580],()=>r(39566));module.exports=a})();