(()=>{var e={};e.id=274,e.ids=[274],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},87923:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>v,routeModule:()=>d,serverHooks:()=>O,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>w});var o={};t.r(o),t.d(o,{GET:()=>u,POST:()=>l});var s=t(96559),n=t(48088),a=t(37719),i=t(32190);async function p(e){if(console.log("[WEBHOOK] Iniciando procesamiento"),!e||"whatsapp_business_account"!==e.object)return void console.error("[WEBHOOK] Payload inv\xe1lido");try{let r=Object(function(){var e=Error("Cannot find module '@/app/api/whatsapp/webhook/webhook.service'");throw e.code="MODULE_NOT_FOUND",e}())(),t=e.entry?.[0],o=t?.changes?.[0],s=o?.value?.messages?.[0];s?(console.log("[WEBHOOK] Mensaje detectado:",s.type),await r.processMessage(s)):console.log("[WEBHOOK] Evento sin mensaje:",o?.value)}catch(e){throw console.error("[WEBHOOK] Error procesando mensaje:",e),e}}!function(){var e=Error("Cannot find module '@/app/api/whatsapp/webhook/webhook.service'");throw e.code="MODULE_NOT_FOUND",e}();let c=process.env.WHATSAPP_WEBHOOK_TOKEN||"MTT0K3N123";async function u(e){let r=new URL(e.url),t=r.searchParams.get("hub.verify_token"),o=r.searchParams.get("hub.challenge");return(console.log("Token recibido:",t),t===c&&o)?new Response(o,{status:200,headers:{"Content-Type":"text/plain"}}):new Response("Token inv\xe1lido",{status:403})}async function l(e){try{let r=await e.json();return console.log("Mensaje recibido:",JSON.stringify(r,null,2)),await p(r),i.NextResponse.json({success:!0})}catch(e){return console.error("Error en POST:",e),i.NextResponse.json({error:"Error interno"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/whatsapp/webhook/route",pathname:"/api/whatsapp/webhook",filename:"route",bundlePath:"app/api/whatsapp/webhook/route"},resolvedPagePath:"C:\\Users\\EQUIPO 2\\whatsapp-clean\\src\\app\\api\\whatsapp\\webhook\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:h,workUnitAsyncStorage:w,serverHooks:O}=d;function v(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:w})}},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[719,580],()=>t(87923));module.exports=o})();