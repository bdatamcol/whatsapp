(()=>{var e={};e.id=274,e.ids=[274],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12518:e=>{"use strict";e.exports=require("mongodb")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31932:(e,t,r)=>{"use strict";let s,o;r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>m,serverHooks:()=>S,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>w});var n={};r.r(n),r.d(n,{POST:()=>O});var a=r(96559),i=r(48088),p=r(37719),c=r(32190),u=r(12518);let d=process.env.MONGODB_URI;if(!d)throw Error("MONGODB_URI is not defined");let l={serverApi:{version:u.ServerApiVersion.v1,strict:!0,deprecationErrors:!0}};async function O(e){let t,r;console.log(JSON.stringify({timestamp:new Date().toISOString(),type:"WEBHOOK_INIT",details:"Iniciando procesamiento de webhook"}));try{if(!(t=await o))throw Error("Client no inicializado");r=t.db(process.env.MONGODB_DB||"whatsapp-business"),await r.command({ping:1}),console.log(JSON.stringify({timestamp:new Date().toISOString(),type:"DB_CONNECTION_SUCCESS",dbName:r.databaseName}));let s=await e.json(),n=s.entry?.[0]?.changes?.[0]?.value?.messages?.[0];if(n){let e=await r.collection("messages").insertOne({...n,processedAt:new Date});return console.log(JSON.stringify({timestamp:new Date().toISOString(),type:"MESSAGE_SAVED",messageId:e.insertedId})),c.NextResponse.json({success:!0})}return c.NextResponse.json({error:"No message found"},{status:400})}catch(e){return console.error(JSON.stringify({timestamp:new Date().toISOString(),type:"FATAL_ERROR",error:{name:e.name,message:e.message,stack:e.stack},connectionStatus:{hasClient:!!t,hasDb:!!r,env:{MONGODB_URI:process.env.MONGODB_URI?"SET":"MISSING",MONGODB_DB:process.env.MONGODB_DB||"default (whatsapp-business)"}}})),c.NextResponse.json({error:"Error interno del servidor"},{status:500})}}o=new u.MongoClient(d,l).connect();let m=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/whatsapp/webhook/route",pathname:"/api/whatsapp/webhook",filename:"route",bundlePath:"app/api/whatsapp/webhook/route"},resolvedPagePath:"C:\\Users\\EQUIPO 2\\whatsapp-clean\\src\\app\\api\\whatsapp\\webhook\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:g,workUnitAsyncStorage:w,serverHooks:S}=m;function h(){return(0,p.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:w})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,580],()=>r(31932));module.exports=s})();