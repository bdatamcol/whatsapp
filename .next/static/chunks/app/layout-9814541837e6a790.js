(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{5302:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_d65c78",variable:"__variable_d65c78"}},11049:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,5302,23)),Promise.resolve().then(a.t.bind(a,51956,23)),Promise.resolve().then(a.t.bind(a,30347,23)),Promise.resolve().then(a.bind(a,23142))},23142:(e,t,a)=>{"use strict";a.d(t,{Providers:()=>o});var r=a(95155),s=a(99663);function o(e){let{children:t}=e;return(0,r.jsx)(s.q,{children:t})}},30347:()=>{},51956:e=>{e.exports={style:{fontFamily:"'Roboto Mono', 'Roboto Mono Fallback'",fontStyle:"normal"},className:"__className_43fb55",variable:"__variable_43fb55"}},99663:(e,t,a)=>{"use strict";a.d(t,{q:()=>c,M:()=>l});var r=a(95155),s=a(12115);class o{async getContacts(){try{return[{id:"521234567890",name:"Cliente Ejemplo",lastMessage:"Hola, \xbfc\xf3mo est\xe1s?",unread:2,lastMessageTime:new Date}]}catch(e){throw console.error("Error fetching contacts:",e),e}}async sendText(e,t){let a=await fetch("".concat(this.baseUrl,"/messages"),{method:"POST",headers:this.getHeaders(),body:JSON.stringify({messaging_product:"whatsapp",recipient_type:"individual",to:e,text:{body:t}})});return this.handleResponse(a)}getHeaders(){return{Authorization:"Bearer ".concat("EAAdmskc6SHwBOxuBjULMfPWk2V6AmDlfeZCTUDUtgj4UmAXAICaI7QEO5H5vH5gZCPOsEC555PIFBv3ob13L1kl0f7Jlt79b99R1IEWEkCZAZBbiNZCFNZCbHjH3k6WxKTD5j5hvC3Y5awZBwDjk3JnYG5BIzr9Hr0p1PpzO0YUqSwiu5rU2fRUdZBg1Px7thVXNZCuJLaYLpVLdzVCPshkPD2iFvpxoZD"),"Content-Type":"application/json"}}async handleResponse(e){if(!e.ok){var t;let a=await e.json();throw console.error("WhatsApp API Error:",a),Error((null==(t=a.error)?void 0:t.message)||"WhatsApp API error")}return e.json()}constructor(){this.baseUrl="https://graph.facebook.com/".concat("v19.0","/").concat("573143728457")}}let n=(0,s.createContext)(void 0),c=e=>{let{children:t}=e,[a,c]=(0,s.useState)({contacts:[],messages:[],selectedContact:null,loading:!1,error:null}),l=new o,i=(0,s.useCallback)(async()=>{c(e=>({...e,loading:!0,error:null}));try{let e=await fetch("/api/whatsapp/contacts");if(!e.ok)throw Error("Error al cargar contactos");let t=await e.json();c(e=>({...e,contacts:t,loading:!1}))}catch(e){c(e=>({...e,error:"Error al cargar contactos",loading:!1}))}},[]),d=(0,s.useCallback)(async e=>{if(a.selectedContact&&e.trim()){c(e=>({...e,loading:!0,error:null}));try{await l.sendText(a.selectedContact,e);let t={id:Date.now().toString(),text:e,timestamp:new Date().toISOString(),direction:"outbound",status:"sent"};c(e=>({...e,messages:[...e.messages,t],loading:!1}))}catch(e){c(e=>({...e,error:"Error al enviar mensaje",loading:!1}))}}},[a.selectedContact]),h=(0,s.useCallback)(async e=>{c(t=>({...t,selectedContact:e,loading:!0,error:null}));try{let t=await fetch("/api/whatsapp/messages?contact=".concat(e));if(!t.ok)throw Error("Error al cargar mensajes");let a=await t.json();c(e=>({...e,messages:a,loading:!1}))}catch(e){c(e=>({...e,error:"Error al cargar mensajes",loading:!1}))}},[]),g=(0,s.useCallback)(async()=>{if(a.selectedContact){c(e=>({...e,loading:!0,error:null}));try{let e=a.messages[0],t=await fetch("/api/whatsapp/messages?contact=".concat(a.selectedContact,"&before=").concat(e.timestamp)),r=await t.json();c(e=>({...e,messages:[...r,...e.messages],loading:!1}))}catch(e){c(e=>({...e,error:"Error al cargar m\xe1s mensajes",loading:!1}))}}},[a.selectedContact,a.messages]);return(0,s.useEffect)(()=>{i()},[i]),(0,r.jsx)(n.Provider,{value:{...a,selectContact:h,sendMessage:d,refreshContacts:i,loadMoreMessages:g},children:t})},l=()=>{let e=(0,s.useContext)(n);if(!e)throw Error("useWhatsApp debe usarse dentro de WhatsAppProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[754,441,684,358],()=>t(11049)),_N_E=e.O()}]);