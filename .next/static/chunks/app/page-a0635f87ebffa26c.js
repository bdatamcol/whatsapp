(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1373:(e,s,a)=>{Promise.resolve().then(a.bind(a,34700))},18243:()=>{},34700:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>el});var t=a(95155),r=a(12115);let l=e=>{let{children:s,className:a=""}=e;return(0,t.jsx)("div",{className:"rounded-2xl shadow-lg bg-white p-4 ".concat(a),children:s})},n=e=>{let{children:s,className:a=""}=e;return(0,t.jsx)("div",{className:"p-4 ".concat(a),children:s})},c=e=>{let{children:s,className:a=""}=e;return(0,t.jsx)("div",{className:"border-b pb-2 mb-4 ".concat(a),children:s})},i=e=>{let{children:s,className:a=""}=e;return(0,t.jsx)("h2",{className:"text-xl font-bold ".concat(a),children:s})};var o=a(99708);let d=r.forwardRef((e,s)=>{let{className:a,variant:r="default",size:l="default",asChild:n=!1,...c}=e,i=n?o.DX:"button";return(0,t.jsx)(i,{className:"".concat("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background"," ").concat({default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary"}[r]," ").concat({default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10"}[l]," ").concat(a),ref:s,...c})});d.displayName="Button";var m=a(83540),x=a(56965),h=a(94754),u=a(96025),p=a(16238),g=a(94517),j=a(21374);let f=()=>(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("header",{className:"mb-6",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Panel de Control"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Resumen general de tu CRM"})]}),(0,t.jsxs)("div",{className:"grid gap-6",children:[(0,t.jsx)(l,{children:(0,t.jsxs)(n,{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Estad\xedsticas Generales"}),(0,t.jsx)("div",{className:"h-[300px]",children:(0,t.jsx)(m.u,{width:"100%",height:"100%",children:(0,t.jsxs)(x.b,{data:[{name:"Lun",ventas:400},{name:"Mar",ventas:300},{name:"Mi\xe9",ventas:500},{name:"Jue",ventas:700},{name:"Vie",ventas:600},{name:"S\xe1b",ventas:800},{name:"Dom",ventas:400}],children:[(0,t.jsx)(h.d,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,t.jsx)(u.W,{dataKey:"name",stroke:"#6b7280"}),(0,t.jsx)(p.h,{stroke:"#6b7280"}),(0,t.jsx)(g.m,{}),(0,t.jsx)(j.N,{type:"monotone",dataKey:"ventas",stroke:"#3b82f6",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})})})]})}),(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,t.jsx)(l,{children:(0,t.jsxs)(n,{className:"p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Total de Leads"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:"1,254"})]})}),(0,t.jsx)(l,{children:(0,t.jsxs)(n,{className:"p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Total de Mensajes"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:"4,752"})]})})]}),(0,t.jsx)(l,{children:(0,t.jsx)(n,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-1",children:"Configuraciones Pendientes"}),(0,t.jsx)("p",{className:"text-gray-600",children:"3 tareas por completar"})]}),(0,t.jsx)(d,{className:"bg-blue-600 hover:bg-blue-700",children:"Ir a Configuraci\xf3n"})]})})})]})]});function b(){let[e,s]=(0,r.useState)([]),[a,l]=(0,r.useState)(""),[n,c]=(0,r.useState)(""),[i,o]=(0,r.useState)([]),[d,m]=(0,r.useState)(""),[x,h]=(0,r.useState)([]),[u,p]=(0,r.useState)(""),[g,j]=(0,r.useState)({pages:!1,forms:!1,leads:!1});return(0,r.useEffect)(()=>{(async()=>{j(e=>({...e,pages:!0})),p("");try{var e;let a=await fetch("/api/marketing/account"),t=await a.json();if(!a.ok||t.error)throw Error(t.error||"Error al obtener p\xe1ginas");let r=(null==(e=t.pages)?void 0:e.filter(e=>e.access_token))||[];s(r),0===r.length&&p("No se encontraron p\xe1ginas con permisos suficientes")}catch(e){p(e.message||"Error al cargar p\xe1ginas"),console.error("Error fetching pages:",e)}finally{j(e=>({...e,pages:!1}))}})()},[]),(0,r.useEffect)(()=>{a&&n&&(async()=>{j(e=>({...e,forms:!0})),p("");try{let e=await fetch("/api/leads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pageId:a,pageAccessToken:n})}),s=await e.json();if(!e.ok||s.error)throw Error(s.error||"Error al cargar formularios");o(s.data||[]),m(""),h([])}catch(e){p(e.message||"Error al cargar formularios"),console.error("Error fetching forms:",e)}finally{j(e=>({...e,forms:!1}))}})()},[a,n]),(0,r.useEffect)(()=>{d&&n&&(async()=>{j(e=>({...e,leads:!0})),p("");try{let e=await fetch("/api/leads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formId:d,pageAccessToken:n})}),s=await e.json();if(!e.ok||s.error)throw Error(s.error||"Error al obtener leads");h(s.data||[])}catch(e){p(e.message||"Error al obtener leads"),console.error("Error fetching leads:",e)}finally{j(e=>({...e,leads:!1}))}})()},[d,n]),(0,t.jsxs)("div",{className:"p-4 max-w-6xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-xl font-bold mb-4",children:"\uD83D\uDCCB Leads recibidos"}),u&&(0,t.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:u}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecciona una p\xe1gina:"}),(0,t.jsxs)("select",{value:a,onChange:s=>{let a=s.target.value,t=e.find(e=>e.id===a);return t?t.access_token?void(l(a),c(t.access_token),p("")):void p("Esta p\xe1gina no tiene token de acceso v\xe1lido"):void p("P\xe1gina no encontrada")},disabled:g.pages,className:"block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[(0,t.jsx)("option",{value:"",children:"-- Selecciona --"}),e.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," ",!e.access_token&&"(sin permisos)"]},e.id))]}),g.pages&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Cargando p\xe1ginas..."})]}),a&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecciona un formulario:"}),(0,t.jsxs)("select",{value:d,onChange:e=>m(e.target.value),disabled:g.forms||0===i.length,className:"block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[(0,t.jsx)("option",{value:"",children:"-- Selecciona --"}),i.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]}),g.forms&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Cargando formularios..."}),!g.forms&&0===i.length&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"No se encontraron formularios para esta p\xe1gina"})]}),g.leads&&(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Cargando leads..."}),x.length>0&&(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\uD83E\uDDD1 Nombre"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\uD83D\uDCE7 Correo"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\uD83D\uDCDE Tel\xe9fono"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\uD83D\uDCC6 Fecha"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map((e,s)=>{var a,r,l,n,c,i,o,d,m;return(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(null==(l=e.field_data)||null==(r=l.find(e=>"full_name"===e.name))||null==(a=r.values)?void 0:a[0])||"—"}),(0,t.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(null==(i=e.field_data)||null==(c=i.find(e=>"email"===e.name))||null==(n=c.values)?void 0:n[0])||"—"}),(0,t.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(null==(m=e.field_data)||null==(d=m.find(e=>"phone_number"===e.name))||null==(o=d.values)?void 0:o[0])||"—"}),(0,t.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:new Date(e.created_time).toLocaleString()})]},s)})})]})})]})}var v=a(71007),N=a(32919),y=a(23861),w=a(34869);let C=[{title:"Perfil",icon:(0,t.jsx)(v.A,{className:"w-6 h-6"}),description:"Actualiza tu informaci\xf3n personal."},{title:"Seguridad",icon:(0,t.jsx)(N.A,{className:"w-6 h-6"}),description:"Gestiona tu contrase\xf1a y autenticaci\xf3n."},{title:"Notificaciones",icon:(0,t.jsx)(y.A,{className:"w-6 h-6"}),description:"Configura las alertas que recibes."},{title:"Preferencias",icon:(0,t.jsx)(w.A,{className:"w-6 h-6"}),description:"Ajusta idioma y tema."}],k=()=>{let[e,s]=(0,r.useState)(0);return(0,t.jsxs)("div",{className:"p-6 bg-gray-50 min-h-screen",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Ajustes"}),(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:C.map((a,r)=>(0,t.jsxs)("div",{onClick:()=>s(r),className:"flex items-center p-4 rounded-xl shadow-md transition-all cursor-pointer \n              ".concat(e===r?"bg-blue-100 border border-blue-500 shadow-lg":"bg-white"," \n              hover:bg-blue-50 hover:shadow-lg hover:scale-105"),children:[(0,t.jsx)("div",{className:"mr-4 text-blue-600",children:a.icon}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:a.title}),(0,t.jsx)("p",{className:"text-gray-600",children:a.description})]})]},r))})]})};var E=a(90105);let A=e=>{let{...s}=e;return(0,t.jsx)("input",{...s,className:"border border-gray-300 p-2 rounded-md w-full"})};function S(e){let{messages:s,selectedContact:a,onSendMessage:l,onLoadMore:n}=e,[c,i]=(0,r.useState)(""),o=(0,r.useRef)(null),m=(0,r.useRef)(null),x=()=>{c.trim()&&(l(c),i(""))};return(0,r.useEffect)(()=>{var e;null==(e=o.current)||e.scrollIntoView({behavior:"smooth"})},[s]),(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"p-4 border-b bg-white flex items-center gap-3",children:[(0,t.jsx)("div",{className:"bg-gray-200 rounded-full h-10 w-10 flex items-center justify-center",children:(null==a?void 0:a.avatar)?(0,t.jsx)("img",{src:a.avatar,alt:a.name,className:"rounded-full h-full w-full object-cover"}):(0,t.jsx)("span",{className:"text-gray-500",children:null==a?void 0:a.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium",children:null==a?void 0:a.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:(null==a?void 0:a.lastMessage)?"\xdalt. mensaje: ".concat(a.lastMessage):"En l\xednea"})]})]}),(0,t.jsxs)("div",{ref:m,onScroll:()=>{var e;(null==(e=m.current)?void 0:e.scrollTop)===0&&n()},className:"flex-1 overflow-y-auto p-4 space-y-2 bg-gray-50",children:[s.map(e=>(0,t.jsx)("div",{className:"flex ".concat("outbound"===e.direction?"justify-end":"justify-start"),children:(0,t.jsxs)("div",{className:"p-3 rounded-lg max-w-xs md:max-w-md ".concat("outbound"===e.direction?"bg-blue-500 text-white":"bg-white border"),children:[(0,t.jsx)("p",{children:e.text}),(0,t.jsx)("p",{className:"text-xs mt-1 ".concat("outbound"===e.direction?"text-blue-100":"text-gray-500"),children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)),(0,t.jsx)("div",{ref:o})]}),(0,t.jsx)("div",{className:"p-4 border-t bg-white",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(A,{value:c,onChange:e=>i(e.target.value),onKeyPress:e=>"Enter"===e.key&&x(),placeholder:"Escribe un mensaje...",className:"flex-1"}),(0,t.jsx)(d,{onClick:x,disabled:!c.trim(),children:(0,t.jsx)(E.A,{className:"h-4 w-4"})})]})})]})}var D=a(51154),M=a(29468),P=a(44020),_=a(53904),L=a(381),z=a(47924),T=a(35169),I=a(99424),O=a(99663),R=a(52596),B=a(39688);function U(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return(0,B.QP)((0,R.$)(s))}var W=a(65021);function Z(e){let{...s}=e;return(0,t.jsx)(W.bL,{"data-slot":"dropdown-menu",...s})}function F(e){let{...s}=e;return(0,t.jsx)(W.l9,{"data-slot":"dropdown-menu-trigger",...s})}function H(e){let{className:s,sideOffset:a=4,...r}=e;return(0,t.jsx)(W.ZL,{children:(0,t.jsx)(W.UC,{"data-slot":"dropdown-menu-content",sideOffset:a,className:U("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",s),...r})})}function K(e){let{className:s,inset:a,variant:r="default",...l}=e;return(0,t.jsx)(W.q7,{"data-slot":"dropdown-menu-item","data-inset":a,"data-variant":r,className:U("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...l})}function V(e){let{initialContact:s}=e,{contacts:a,selectedContact:l,messages:n,loading:c,error:i,selectContact:o,sendMessage:m,refreshContacts:x}=(0,O.M)(),[h,u]=(0,r.useState)(""),[p,g]=(0,r.useState)(!1),[j,f]=(0,r.useState)(!1);(0,r.useMemo)(()=>a.filter(e=>{var s;return e.name.toLowerCase().includes(h.toLowerCase())||(null==(s=e.lastMessage)?void 0:s.toLowerCase().includes(h.toLowerCase()))}),[a,h]);let b=(0,r.useMemo)(()=>a.find(e=>e.id===l),[a,l]);(0,r.useCallback)(e=>{o(e),g(!0)},[o]);let v=(0,r.useCallback)(e=>{u(e.target.value)},[]),N=(0,r.useCallback)(()=>{console.log("Cargando m\xe1s mensajes...")},[]),y=(0,r.useCallback)(()=>{x()},[x]);return c?(0,t.jsx)("div",{className:"flex items-center justify-center h-full bg-gray-50",children:(0,t.jsx)(D.A,{className:"animate-spin h-12 w-12 text-blue-500"})}):i?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 text-red-500 p-4",children:[(0,t.jsx)(M.A,{className:"h-12 w-12 mb-4"}),(0,t.jsx)("p",{className:"text-lg font-medium mb-2",children:"Error al cargar conversaciones"}),(0,t.jsx)("p",{className:"text-sm mb-4",children:i}),(0,t.jsx)(d,{variant:"outline",onClick:y,children:"Reintentar"})]}):(0,t.jsxs)("div",{className:"flex h-[calc(100vh-64px)] bg-gray-50",children:[(0,t.jsxs)("div",{className:U("w-full md:w-96 flex flex-col border-r bg-white transition-all duration-300",p?"hidden md:flex":"flex"),children:[(0,t.jsxs)("div",{className:"p-3 border-b sticky top-0 bg-white z-10",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Conversaciones"}),(0,t.jsxs)(Z,{onOpenChange:f,children:[(0,t.jsx)(F,{asChild:!0,children:(0,t.jsx)(d,{variant:"ghost",size:"icon",className:U("rounded-full hover:bg-gray-100",j&&"bg-gray-100"),children:(0,t.jsx)(P.A,{className:"h-5 w-5"})})}),(0,t.jsxs)(H,{align:"end",children:[(0,t.jsxs)(K,{onClick:y,children:[(0,t.jsx)(_.A,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Actualizar"})]}),(0,t.jsxs)(K,{children:[(0,t.jsx)(L.A,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Configuraci\xf3n"})]})]})]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(z.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)(A,{placeholder:"Buscar contactos...",className:"pl-9",value:h,onChange:v})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto"})]}),(0,t.jsx)("div",{className:U("flex-1 flex flex-col bg-gray-50",p?"flex":"hidden md:flex"),children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-3 border-b bg-white sticky top-0 z-10 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("button",{onClick:()=>g(!1),className:"md:hidden mr-2 p-1 rounded-full hover:bg-gray-100","aria-label":"Volver",children:(0,t.jsx)(T.A,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:(null==b?void 0:b.avatar)?(0,t.jsx)("img",{src:b.avatar,alt:b.name,className:"w-full h-full object-cover"}):(0,t.jsx)("span",{className:"text-gray-600 font-medium",children:null==b?void 0:b.name.charAt(0).toUpperCase()})}),(null==b?void 0:b.isOnline)&&(0,t.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium",children:null==b?void 0:b.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:(null==b?void 0:b.isOnline)?"En l\xednea":"\xdalt. vez hoy a las 14:30"})]})]})]}),(0,t.jsx)("button",{className:"p-1 rounded-full hover:bg-gray-100",children:(0,t.jsx)(P.A,{className:"h-5 w-5"})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:(0,t.jsx)(S,{messages:n,onSendMessage:m,onLoadMore:N,selectedContact:b})})]}):(0,t.jsx)("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:(0,t.jsxs)("div",{className:"max-w-md",children:[(0,t.jsx)(I.A,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),(0,t.jsx)("h3",{className:"text-xl font-medium text-gray-500 mb-2",children:p?"Volver a conversaciones":"Selecciona una conversaci\xf3n"}),(0,t.jsx)("p",{className:"text-gray-400 mb-6",children:p?"":"Elige un contacto para comenzar a chatear"}),(0,t.jsxs)(d,{variant:"outline",className:"gap-2",onClick:y,children:[(0,t.jsx)(_.A,{className:"h-4 w-4"}),"Actualizar lista"]})]})})})]})}console.log("DropdownMenu:","function"),console.log("DropdownMenuTrigger:","function"),console.log("DropdownMenuContent:","function"),console.log("DropdownMenuItem:","function"),console.log("WhatsAppChat:","function"),console.log("Input:",typeof A),console.log("Button:",typeof d);var G=a(55670),J=a(50741),q=a(84355),Y=a(19663),X=a(89051),Q=a(24026);let $=()=>{let[e,s]=(0,r.useState)([]),[a,o]=(0,r.useState)([]),[d,f]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/marketing/insights");if(!e.ok){let s=await e.text();console.error("Error en la solicitud:",s||"Respuesta vac\xeda");return}let a=await e.json();console.log("Datos recibidos:",a),s(a.data),o(a.data)}catch(e){console.error("Error al obtener los datos:",e)}})()},[]);let b=Array.from(new Set(e.map(e=>e.campaignName)));return(0,t.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)("select",{value:d,onChange:s=>{let a=s.target.value;f(a),""===a?o(e):o(e.filter(e=>e.campaignName===a))},className:"p-2 border border-gray-300 rounded",children:[(0,t.jsx)("option",{value:"",children:"Todas las Campa\xf1as"}),b.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})}),(0,t.jsxs)(l,{className:"w-full",children:[(0,t.jsx)(c,{children:(0,t.jsx)(i,{children:"Gr\xe1fico de Rendimiento"})}),(0,t.jsx)(n,{children:(0,t.jsx)(m.u,{width:"100%",height:400,children:(0,t.jsxs)(x.b,{data:a,margin:{top:20,right:30,left:0,bottom:0},children:[(0,t.jsx)(h.d,{strokeDasharray:"3 3"}),(0,t.jsx)(u.W,{dataKey:"campaignName"}),(0,t.jsx)(p.h,{}),(0,t.jsx)(g.m,{}),(0,t.jsx)(Q.s,{}),(0,t.jsx)(j.N,{type:"monotone",dataKey:"spend",stroke:"#8884d8"}),(0,t.jsx)(j.N,{type:"monotone",dataKey:"impressions",stroke:"#82ca9d"}),(0,t.jsx)(j.N,{type:"monotone",dataKey:"clicks",stroke:"#ff7300"})]})})})]}),(0,t.jsxs)(l,{className:"w-full",children:[(0,t.jsx)(c,{children:(0,t.jsx)(i,{children:"M\xe9tricas Detalladas"})}),(0,t.jsx)(n,{children:(0,t.jsx)(X.FK,{children:(0,t.jsxs)("table",{className:"w-full text-sm text-left text-gray-500",children:[(0,t.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3",children:"Nombre de la Campa\xf1a"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Fecha Inicio"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Fecha Fin"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Gasto"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Impresiones"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Alcance"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Clics"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"CPC"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"CTR"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Frecuencia"})]})}),(0,t.jsx)("tbody",{children:a.map((e,s)=>(0,t.jsxs)("tr",{className:"bg-white border-b hover:bg-gray-100",children:[(0,t.jsx)("td",{className:"px-6 py-4",children:e.campaignName}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.dateStart}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.dateStop}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.spend}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.impressions}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.reach}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.clicks}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.cpc}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.ctr}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.frequency})]},s))})]})})})]})]})};function ee(){let[e,s]=(0,r.useState)(null),[a,l]=(0,r.useState)([]),[n,c]=(0,r.useState)(!0),[i,o]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/marketing/account"),a=await e.json();e.ok?(s(a.account),l(a.pages)):(console.error("Error:",a.error),o(a.error||"Error desconocido"))}catch(e){console.error("Error de red:",e),o("Error de red")}finally{c(!1)}})()},[]),n)?(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"Cargando informaci\xf3n de cuenta..."}):i?(0,t.jsxs)("p",{className:"text-red-500 text-sm",children:["Error: ",i]}):(0,t.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Informaci\xf3n de la Cuenta de Marketing"}),e?(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ID:"})," ",e.id]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Nombre:"})," ",e.name]}),e.business_name&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Empresa:"})," ",e.business_name]}),e.created_time&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Creada:"})," ",new Date(e.created_time).toLocaleDateString()]}),e.status&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Estado:"})," ",e.status]})]}):(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"No hay datos de cuenta disponibles."}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"P\xe1ginas Asociadas"}),(0,t.jsx)("ul",{className:"space-y-4",children:Array.isArray(a)&&a.length>0?a.map(e=>(0,t.jsxs)("li",{className:"p-4 border rounded-lg",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Nombre:"})," ",e.name]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ID:"})," ",e.id]}),void 0!==e.fan_count&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Seguidores:"})," ",e.fan_count.toLocaleString()]}),e.category&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Categor\xeda:"})," ",e.category]})]},e.id)):(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"No hay p\xe1ginas disponibles."})})]})}var es=a(18243),ea=a.n(es);let et=[{name:"Accounts",description:"Gesti\xf3n de cuentas publicitarias",icon:(0,t.jsx)(G.A,{size:40}),component:"AccountManager"},{name:"Ads",description:"Gesti\xf3n de anuncios publicitarios",icon:(0,t.jsx)(J.A,{size:40}),component:"AdsManage"},{name:"Insights",description:"Estad\xedsticas y m\xe9tricas",icon:(0,t.jsx)(q.A,{size:40}),component:"MetricsDashboard"}],er=()=>{let[e,s]=(0,r.useState)(null);return(0,t.jsxs)("div",{className:"p-6 bg-gray-50 min-h-screen",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Marketing"}),e?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("button",{onClick:()=>s(null),className:"flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:[(0,t.jsx)(T.A,{size:18}),"Volver al Dashboard"]}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:(()=>{switch(e){case"AccountManager":return(0,t.jsx)(ee,{});case"AdsManage":return(0,t.jsx)(ea(),{});case"MetricsDashboard":return(0,t.jsx)($,{});default:return null}})()})]}):(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:et.map(e=>(0,t.jsxs)(Y.P.div,{whileHover:{scale:1.03},whileTap:{scale:.98},onClick:()=>s(e.component),className:"cursor-pointer rounded-xl bg-white p-4 shadow-md transition-all hover:shadow-lg",children:[(0,t.jsx)("div",{className:"text-center mb-4",children:e.icon}),(0,t.jsx)("h2",{className:"text-xl font-bold mb-2",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]},e.name))})]})};function el(){let[e,s]=(0,r.useState)("Panelcontrol");return(0,t.jsxs)("div",{className:"flex min-h-screen",children:[(0,t.jsxs)("div",{className:"w-64 bg-gray-800 text-white p-4 flex flex-col",children:[(0,t.jsx)("div",{className:"text-2xl font-bold mb-6 p-2",children:"\uD83D\uDCCA Bdatam CRM"}),(0,t.jsx)("nav",{className:"flex-1 space-y-2",children:[{name:"Panelcontrol",label:"Panel de control"},{name:"Mensajes",label:"Mensajes"},{name:"Leads",label:"Leads"},{name:"Ajustes",label:"Ajustes"},{name:"Marketing",label:"Marketing"}].map(a=>(0,t.jsx)("button",{onClick:()=>s(a.name),className:"w-full text-left p-3 rounded-lg transition-colors ".concat(e===a.name?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-700"),children:a.label},a.name))})]}),(0,t.jsx)("main",{className:"flex-1 overflow-auto bg-gray-50",children:(()=>{switch(e){case"Panelcontrol":default:return(0,t.jsx)(f,{});case"Mensajes":return(0,t.jsx)(V,{});case"Leads":return(0,t.jsx)(b,{});case"Ajustes":return(0,t.jsx)(k,{});case"Marketing":return(0,t.jsx)(er,{})}})()})]})}},99663:(e,s,a)=>{"use strict";a.d(s,{q:()=>c,M:()=>i});var t=a(95155),r=a(12115);class l{async getContacts(){try{return[{id:"521234567890",name:"Cliente Ejemplo",lastMessage:"Hola, \xbfc\xf3mo est\xe1s?",unread:2,lastMessageTime:new Date}]}catch(e){throw console.error("Error fetching contacts:",e),e}}async sendText(e,s){let a=await fetch("".concat(this.baseUrl,"/messages"),{method:"POST",headers:this.getHeaders(),body:JSON.stringify({messaging_product:"whatsapp",recipient_type:"individual",to:e,text:{body:s}})});return this.handleResponse(a)}getHeaders(){return{Authorization:"Bearer ".concat("EAAdmskc6SHwBOxuBjULMfPWk2V6AmDlfeZCTUDUtgj4UmAXAICaI7QEO5H5vH5gZCPOsEC555PIFBv3ob13L1kl0f7Jlt79b99R1IEWEkCZAZBbiNZCFNZCbHjH3k6WxKTD5j5hvC3Y5awZBwDjk3JnYG5BIzr9Hr0p1PpzO0YUqSwiu5rU2fRUdZBg1Px7thVXNZCuJLaYLpVLdzVCPshkPD2iFvpxoZD"),"Content-Type":"application/json"}}async handleResponse(e){if(!e.ok){var s;let a=await e.json();throw console.error("WhatsApp API Error:",a),Error((null==(s=a.error)?void 0:s.message)||"WhatsApp API error")}return e.json()}constructor(){this.baseUrl="https://graph.facebook.com/".concat("v19.0","/").concat("573143728457")}}let n=(0,r.createContext)(void 0),c=e=>{let{children:s}=e,[a,c]=(0,r.useState)({contacts:[],messages:[],selectedContact:null,loading:!1,error:null}),i=new l,o=(0,r.useCallback)(async()=>{c(e=>({...e,loading:!0,error:null}));try{let e=await fetch("/api/whatsapp/contacts");if(!e.ok)throw Error("Error al cargar contactos");let s=await e.json();c(e=>({...e,contacts:s,loading:!1}))}catch(e){c(e=>({...e,error:"Error al cargar contactos",loading:!1}))}},[]),d=(0,r.useCallback)(async e=>{if(a.selectedContact&&e.trim()){c(e=>({...e,loading:!0,error:null}));try{await i.sendText(a.selectedContact,e);let s={id:Date.now().toString(),text:e,timestamp:new Date().toISOString(),direction:"outbound",status:"sent"};c(e=>({...e,messages:[...e.messages,s],loading:!1}))}catch(e){c(e=>({...e,error:"Error al enviar mensaje",loading:!1}))}}},[a.selectedContact]),m=(0,r.useCallback)(async e=>{c(s=>({...s,selectedContact:e,loading:!0,error:null}));try{let s=await fetch("/api/whatsapp/messages?contact=".concat(e));if(!s.ok)throw Error("Error al cargar mensajes");let a=await s.json();c(e=>({...e,messages:a,loading:!1}))}catch(e){c(e=>({...e,error:"Error al cargar mensajes",loading:!1}))}},[]),x=(0,r.useCallback)(async()=>{if(a.selectedContact){c(e=>({...e,loading:!0,error:null}));try{let e=a.messages[0],s=await fetch("/api/whatsapp/messages?contact=".concat(a.selectedContact,"&before=").concat(e.timestamp)),t=await s.json();c(e=>({...e,messages:[...t,...e.messages],loading:!1}))}catch(e){c(e=>({...e,error:"Error al cargar m\xe1s mensajes",loading:!1}))}}},[a.selectedContact,a.messages]);return(0,r.useEffect)(()=>{o()},[o]),(0,t.jsx)(n.Provider,{value:{...a,selectContact:m,sendMessage:d,refreshContacts:o,loadMoreMessages:x},children:s})},i=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useWhatsApp debe usarse dentro de WhatsAppProvider");return e}}},e=>{var s=s=>e(e.s=s);e.O(0,[510,441,684,358],()=>s(1373)),_N_E=e.O()}]);