(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1373:(e,s,a)=>{Promise.resolve().then(a.bind(a,87865))},2747:()=>{},13718:()=>{},16592:()=>{},21406:()=>{},22855:()=>{},23488:()=>{},25320:()=>{},28426:()=>{},29069:()=>{},41541:()=>{},47698:()=>{},49065:()=>{},55982:(e,s,a)=>{"use strict";let t,r;a.d(s,{q:()=>f,M:()=>j});var n=a(95155),l=a(12115),i=a(49509);class o{async getContacts(){try{return[{id:"521234567890",name:"Cliente Ejemplo",lastMessage:"Hola, \xbfc\xf3mo est\xe1s?",unread:2,lastMessageTime:new Date}]}catch(e){throw console.error("Error fetching contacts:",e),e}}async sendText(e,s){let a=await fetch("".concat(this.baseUrl,"/messages"),{method:"POST",headers:this.getHeaders(),body:JSON.stringify({messaging_product:"whatsapp",recipient_type:"individual",to:e,text:{body:s}})});return this.handleResponse(a)}getHeaders(){if(!i.env.WHATSAPP_ACCESS_TOKEN)throw Error("Missing WHATSAPP_ACCESS_TOKEN in environment");return{Authorization:"Bearer ".concat(i.env.WHATSAPP_ACCESS_TOKEN),"Content-Type":"application/json"}}async handleResponse(e){if(!e.ok){var s;let a=await e.json();throw console.error("WhatsApp API Error:",a),Error((null==(s=a.error)?void 0:s.message)||"WhatsApp API error")}return e.json()}constructor(){if(!i.env.WHATSAPP_PHONE_NUMBER_ID)throw Error("Missing WHATSAPP_PHONE_NUMBER_ID in environment");this.baseUrl="https://graph.facebook.com/".concat("v19.0","/").concat(i.env.WHATSAPP_PHONE_NUMBER_ID)}}var c=a(80544),d=a(49509);async function m(){if(!t){if(!d.env.MONGODB_URI)throw Error("MONGODB_URI no est\xe1 definido en las variables de entorno");t=new c.MongoClient(d.env.MONGODB_URI),await t.connect(),r=t.db(d.env.MONGODB_DB||"whatsapp-business")}return r}async function x(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,a=arguments.length>2?arguments[2]:void 0;try{let t=await m(),r={$or:[{from:e},{to:e}]};return a&&(r.timestamp={$lt:a}),(await t.collection("messages").find(r).sort({timestamp:-1}).limit(s).toArray()).map(e=>({id:e.id,text:e.text||"",direction:e.direction||"inbound",timestamp:e.timestamp instanceof Date?e.timestamp.toISOString():e.timestamp||new Date().toISOString(),...e.status&&{status:e.status},...e.type&&{type:e.type},...e.media&&{media:e.media}}))}catch(e){throw console.error("[DB] Error al obtener mensajes:",e),e}}async function u(){try{let e=await m(),s=[{$sort:{timestamp:-1}},{$group:{_id:{$cond:[{$eq:["$direction","outbound"]},"$to","$from"]},lastMessage:{$first:"$$ROOT"}}},{$replaceRoot:{newRoot:"$lastMessage"}}];return(await e.collection("messages").aggregate(s).toArray()).map(e=>({id:e.id,text:e.text||"",direction:e.direction||"inbound",timestamp:e.timestamp instanceof Date?e.timestamp.toISOString():e.timestamp||new Date().toISOString(),...e.status&&{status:e.status},...e.type&&{type:e.type},...e.media&&{media:e.media}}))}catch(e){throw console.error("[DB] Error al obtener \xfaltimos mensajes:",e),e}}(async function e(){try{let e=await m();await e.collection("messages").createIndex({from:1}),await e.collection("messages").createIndex({to:1}),await e.collection("messages").createIndex({timestamp:-1}),await e.collection("messages").createIndex({from:1,to:1,timestamp:-1}),console.log("[DB] \xcdndices creados correctamente")}catch(e){console.error("[DB] Error al crear \xedndices:",e)}})().catch(console.error);var h=a(49509);let g=a(22213).io,p=(0,l.createContext)(void 0),f=e=>{let{children:s}=e,[a,t]=(0,l.useState)({contacts:[],messages:[],selectedContact:null,loading:!1,error:null,unreadCounts:{}}),[r,i]=(0,l.useState)(null),c=new o;(0,l.useEffect)(()=>{let e=g(h.env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:3001",{transports:["websocket"],reconnectionAttempts:5,reconnectionDelay:1e3});return e.on("connect",()=>{console.log("Conectado al servidor Socket.io")}),e.on("disconnect",()=>{console.log("Desconectado del servidor Socket.io")}),e.on("newMessage",e=>{t(s=>{let a=s.contacts.map(s=>s.id===e.from||s.id===e.to?{...s,lastMessage:e.text,lastMessageTime:e.timestamp}:s),t={...s.unreadCounts};s.selectedContact!==e.from&&"inbound"===e.direction&&(t[e.from]=(t[e.from]||0)+1);let r=s.messages.findIndex(s=>s.id===e.id);if(-1!==r){let n=[...s.messages];return n[r]=e,{...s,contacts:a,messages:n,unreadCounts:t}}return{...s,contacts:a,messages:[e,...s.messages],unreadCounts:t}})}),i(e),()=>{e.disconnect()}},[]);let d=(0,l.useCallback)(async()=>{t(e=>({...e,loading:!0,error:null}));try{let e=await fetch("/api/whatsapp/contacts");if(!e.ok)throw Error("Error al cargar contactos");let s=await e.json(),a=[];if(s.length>0)try{a=await u()}catch(e){console.error("Error al obtener \xfaltimos mensajes:",e)}let r=s.map(e=>{let s=a.find(s=>s.from===e.id||s.to===e.id);return{...e,lastMessage:(null==s?void 0:s.text)||"",lastMessageTime:(null==s?void 0:s.timestamp)||new Date().toISOString(),isOnline:Math.random()>.5}});t(e=>({...e,contacts:r,loading:!1}))}catch(e){console.error("Error loading contacts:",e),t(e=>({...e,error:"Error al cargar contactos",loading:!1}))}},[]),m=(0,l.useCallback)(async e=>{if(a.selectedContact&&e.trim()){t(e=>({...e,loading:!0,error:null}));try{let s="temp-".concat(Date.now()),n={id:s,from:a.selectedContact,text:e,timestamp:new Date().toISOString(),direction:"outbound",status:"sending"};t(e=>({...e,messages:[...e.messages,n]}));let l=await c.sendText(a.selectedContact,e);t(e=>({...e,messages:e.messages.map(e=>e.id===s?{...e,id:l.id,status:"sent"}:e),loading:!1})),t(s=>({...s,contacts:s.contacts.map(s=>s.id===a.selectedContact?{...s,lastMessage:e,lastMessageTime:new Date().toISOString()}:s)})),r&&r.emit("newMessage",{...n,id:l.id,status:"sent"})}catch(e){console.error("Error sending message:",e),t(e=>({...e,messages:e.messages.filter(e=>!e.id.startsWith("temp-")),error:"Error al enviar mensaje",loading:!1}))}}},[a.selectedContact,r]),f=(0,l.useCallback)(async e=>{t(s=>({...s,selectedContact:e,loading:!0,error:null,unreadCounts:{...s.unreadCounts,[e]:0}}));try{let s=await x(e);t(e=>({...e,messages:s,loading:!1}))}catch(e){console.error("Error loading messages:",e),t(e=>({...e,error:"Error al cargar mensajes",loading:!1}))}},[]),j=(0,l.useCallback)(async()=>{if(a.selectedContact&&0!==a.messages.length&&!a.loading){t(e=>({...e,loading:!0,error:null}));try{let e=a.messages[a.messages.length-1];if(!(null==e?void 0:e.timestamp))return console.warn("No se encontr\xf3 timestamp en el mensaje m\xe1s antiguo"),t(e=>({...e,loading:!1}));let s="string"==typeof e.timestamp?e.timestamp:e.timestamp instanceof Date?e.timestamp.toISOString():new Date().toISOString(),r=await x(a.selectedContact,20,s);t(e=>({...e,messages:r.length>0?[...e.messages,...r]:e.messages,loading:!1}))}catch(e){console.error("Error al cargar m\xe1s mensajes:",e),t(e=>({...e,error:"Error al cargar m\xe1s mensajes",loading:!1}))}}},[a.selectedContact,a.messages,a.loading]),b=(0,l.useCallback)(e=>{t(s=>({...s,messages:s.messages.map(s=>s.id===e?{...s,status:"read"}:s)}))},[]);return(0,l.useEffect)(()=>{d();let e=setInterval(d,3e4);return()=>clearInterval(e)},[d]),(0,n.jsx)(p.Provider,{value:{...a,selectContact:f,sendMessage:m,refreshContacts:d,loadMoreMessages:j,markAsRead:b},children:s})},j=()=>{let e=(0,l.useContext)(p);if(!e)throw Error("useWhatsApp debe usarse dentro de WhatsAppProvider");return e}},61693:()=>{},66792:()=>{},71604:()=>{},87094:()=>{},87865:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>en});var t=a(95155),r=a(12115);let n=e=>{let{children:s,className:a=""}=e;return(0,t.jsx)("div",{className:"rounded-2xl shadow-lg bg-white p-4 ".concat(a),children:s})},l=e=>{let{children:s,className:a=""}=e;return(0,t.jsx)("div",{className:"p-4 ".concat(a),children:s})},i=e=>{let{children:s,className:a=""}=e;return(0,t.jsx)("div",{className:"border-b pb-2 mb-4 ".concat(a),children:s})},o=e=>{let{children:s,className:a=""}=e;return(0,t.jsx)("h2",{className:"text-xl font-bold ".concat(a),children:s})};var c=a(99708);let d=r.forwardRef((e,s)=>{let{className:a,variant:r="default",size:n="default",asChild:l=!1,...i}=e,o=l?c.DX:"button";return(0,t.jsx)(o,{className:"".concat("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background"," ").concat({default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary"}[r]," ").concat({default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10"}[n]," ").concat(a),ref:s,...i})});d.displayName="Button";var m=a(83540),x=a(56965),u=a(94754),h=a(96025),g=a(16238),p=a(94517),f=a(21374);let j=()=>(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("header",{className:"mb-6",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Panel de Control"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Resumen general de tu CRM"})]}),(0,t.jsxs)("div",{className:"grid gap-6",children:[(0,t.jsx)(n,{children:(0,t.jsxs)(l,{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Estad\xedsticas Generales"}),(0,t.jsx)("div",{className:"h-[300px]",children:(0,t.jsx)(m.u,{width:"100%",height:"100%",children:(0,t.jsxs)(x.b,{data:[{name:"Lun",ventas:400},{name:"Mar",ventas:300},{name:"Mi\xe9",ventas:500},{name:"Jue",ventas:700},{name:"Vie",ventas:600},{name:"S\xe1b",ventas:800},{name:"Dom",ventas:400}],children:[(0,t.jsx)(u.d,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,t.jsx)(h.W,{dataKey:"name",stroke:"#6b7280"}),(0,t.jsx)(g.h,{stroke:"#6b7280"}),(0,t.jsx)(p.m,{}),(0,t.jsx)(f.N,{type:"monotone",dataKey:"ventas",stroke:"#3b82f6",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})})})]})}),(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,t.jsx)(n,{children:(0,t.jsxs)(l,{className:"p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Total de Leads"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:"1,254"})]})}),(0,t.jsx)(n,{children:(0,t.jsxs)(l,{className:"p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Total de Mensajes"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:"4,752"})]})})]}),(0,t.jsx)(n,{children:(0,t.jsx)(l,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-1",children:"Configuraciones Pendientes"}),(0,t.jsx)("p",{className:"text-gray-600",children:"3 tareas por completar"})]}),(0,t.jsx)(d,{className:"bg-blue-600 hover:bg-blue-700",children:"Ir a Configuraci\xf3n"})]})})})]})]});function b(){let[e,s]=(0,r.useState)([]),[a,n]=(0,r.useState)(""),[l,i]=(0,r.useState)(""),[o,c]=(0,r.useState)([]),[d,m]=(0,r.useState)(""),[x,u]=(0,r.useState)([]),[h,g]=(0,r.useState)(""),[p,f]=(0,r.useState)({pages:!1,forms:!1,leads:!1});return(0,r.useEffect)(()=>{(async()=>{f(e=>({...e,pages:!0})),g("");try{var e;let a=await fetch("/api/marketing/account"),t=await a.json();if(!a.ok||t.error)throw Error(t.error||"Error al obtener p\xe1ginas");let r=(null==(e=t.pages)?void 0:e.filter(e=>e.access_token))||[];s(r),0===r.length&&g("No se encontraron p\xe1ginas con permisos suficientes")}catch(e){g(e.message||"Error al cargar p\xe1ginas"),console.error("Error fetching pages:",e)}finally{f(e=>({...e,pages:!1}))}})()},[]),(0,r.useEffect)(()=>{a&&l&&(async()=>{f(e=>({...e,forms:!0})),g("");try{let e=await fetch("/api/leads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pageId:a,pageAccessToken:l})}),s=await e.json();if(!e.ok||s.error)throw Error(s.error||"Error al cargar formularios");c(s.data||[]),m(""),u([])}catch(e){g(e.message||"Error al cargar formularios"),console.error("Error fetching forms:",e)}finally{f(e=>({...e,forms:!1}))}})()},[a,l]),(0,r.useEffect)(()=>{d&&l&&(async()=>{f(e=>({...e,leads:!0})),g("");try{let e=await fetch("/api/leads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formId:d,pageAccessToken:l})}),s=await e.json();if(!e.ok||s.error)throw Error(s.error||"Error al obtener leads");u(s.data||[])}catch(e){g(e.message||"Error al obtener leads"),console.error("Error fetching leads:",e)}finally{f(e=>({...e,leads:!1}))}})()},[d,l]),(0,t.jsxs)("div",{className:"p-4 max-w-6xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-xl font-bold mb-4",children:"\uD83D\uDCCB Leads recibidos"}),h&&(0,t.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:h}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecciona una p\xe1gina:"}),(0,t.jsxs)("select",{value:a,onChange:s=>{let a=s.target.value,t=e.find(e=>e.id===a);return t?t.access_token?void(n(a),i(t.access_token),g("")):void g("Esta p\xe1gina no tiene token de acceso v\xe1lido"):void g("P\xe1gina no encontrada")},disabled:p.pages,className:"block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[(0,t.jsx)("option",{value:"",children:"-- Selecciona --"}),e.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," ",!e.access_token&&"(sin permisos)"]},e.id))]}),p.pages&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Cargando p\xe1ginas..."})]}),a&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecciona un formulario:"}),(0,t.jsxs)("select",{value:d,onChange:e=>m(e.target.value),disabled:p.forms||0===o.length,className:"block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[(0,t.jsx)("option",{value:"",children:"-- Selecciona --"}),o.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]}),p.forms&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Cargando formularios..."}),!p.forms&&0===o.length&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"No se encontraron formularios para esta p\xe1gina"})]}),p.leads&&(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Cargando leads..."}),x.length>0&&(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\uD83E\uDDD1 Nombre"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\uD83D\uDCE7 Correo"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\uD83D\uDCDE Tel\xe9fono"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\uD83D\uDCC6 Fecha"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map((e,s)=>{var a,r,n,l,i,o,c,d,m;return(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(null==(n=e.field_data)||null==(r=n.find(e=>"full_name"===e.name))||null==(a=r.values)?void 0:a[0])||"—"}),(0,t.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(null==(o=e.field_data)||null==(i=o.find(e=>"email"===e.name))||null==(l=i.values)?void 0:l[0])||"—"}),(0,t.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(null==(m=e.field_data)||null==(d=m.find(e=>"phone_number"===e.name))||null==(c=d.values)?void 0:c[0])||"—"}),(0,t.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:new Date(e.created_time).toLocaleString()})]},s)})})]})})]})}var v=a(71007),N=a(32919),y=a(23861),w=a(34869);let C=[{title:"Perfil",icon:(0,t.jsx)(v.A,{className:"w-6 h-6"}),description:"Actualiza tu informaci\xf3n personal."},{title:"Seguridad",icon:(0,t.jsx)(N.A,{className:"w-6 h-6"}),description:"Gestiona tu contrase\xf1a y autenticaci\xf3n."},{title:"Notificaciones",icon:(0,t.jsx)(y.A,{className:"w-6 h-6"}),description:"Configura las alertas que recibes."},{title:"Preferencias",icon:(0,t.jsx)(w.A,{className:"w-6 h-6"}),description:"Ajusta idioma y tema."}],S=()=>{let[e,s]=(0,r.useState)(0);return(0,t.jsxs)("div",{className:"p-6 bg-gray-50 min-h-screen",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Ajustes"}),(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:C.map((a,r)=>(0,t.jsxs)("div",{onClick:()=>s(r),className:"flex items-center p-4 rounded-xl shadow-md transition-all cursor-pointer \n              ".concat(e===r?"bg-blue-100 border border-blue-500 shadow-lg":"bg-white"," \n              hover:bg-blue-50 hover:shadow-lg hover:scale-105"),children:[(0,t.jsx)("div",{className:"mr-4 text-blue-600",children:a.icon}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:a.title}),(0,t.jsx)("p",{className:"text-gray-600",children:a.description})]})]},r))})]})};var E=a(51154),k=a(29468),A=a(44020),D=a(53904),_=a(381),M=a(47924),O=a(35169),P=a(99424),I=a(55982),T=a(90105),R=a(52596),L=a(39688);function B(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return(0,L.QP)((0,R.$)(s))}let z=(0,r.forwardRef)((e,s)=>{let{className:a,error:r,...n}=e;return(0,t.jsx)("input",{ref:s,className:B("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background","file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",r&&"border-destructive focus-visible:ring-destructive",a),...n})});function $(e){let{messages:s,selectedContact:a,onSendMessage:n,onLoadMore:l}=e,[i,o]=(0,r.useState)(""),c=(0,r.useRef)(null),m=(0,r.useRef)(null),x=()=>{i.trim()&&(n(i),o(""))};return(0,r.useEffect)(()=>{var e;null==(e=c.current)||e.scrollIntoView({behavior:"smooth"})},[s]),(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"p-4 border-b bg-white flex items-center gap-3",children:[(0,t.jsx)("div",{className:"bg-gray-200 rounded-full h-10 w-10 flex items-center justify-center",children:(null==a?void 0:a.avatar)?(0,t.jsx)("img",{src:a.avatar,alt:a.name,className:"rounded-full h-full w-full object-cover"}):(0,t.jsx)("span",{className:"text-gray-500",children:null==a?void 0:a.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium",children:null==a?void 0:a.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:(null==a?void 0:a.lastMessage)?"\xdalt. mensaje: ".concat(a.lastMessage):"En l\xednea"})]})]}),(0,t.jsxs)("div",{ref:m,onScroll:()=>{var e;(null==(e=m.current)?void 0:e.scrollTop)===0&&l()},className:"flex-1 overflow-y-auto p-4 space-y-2 bg-gray-50",children:[s.map(e=>(0,t.jsx)("div",{className:"flex ".concat("outbound"===e.direction?"justify-end":"justify-start"),children:(0,t.jsxs)("div",{className:"p-3 rounded-lg max-w-xs md:max-w-md ".concat("outbound"===e.direction?"bg-blue-500 text-white":"bg-white border"),children:[(0,t.jsx)("p",{children:e.text}),(0,t.jsx)("p",{className:"text-xs mt-1 ".concat("outbound"===e.direction?"text-blue-100":"text-gray-500"),children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)),(0,t.jsx)("div",{ref:c})]}),(0,t.jsx)("div",{className:"p-4 border-t bg-white",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(z,{value:i,onChange:e=>o(e.target.value),onKeyPress:e=>"Enter"===e.key&&x(),placeholder:"Escribe un mensaje...",className:"flex-1"}),(0,t.jsx)(d,{onClick:x,disabled:!i.trim(),children:(0,t.jsx)(T.A,{className:"h-4 w-4"})})]})})]})}function U(e){let{contacts:s,selectedContact:a,onSelectContact:r}=e;return(0,t.jsx)("div",{className:"overflow-y-auto h-[calc(100vh-180px)]",children:s.map(e=>(0,t.jsx)("div",{onClick:()=>r(e.id),className:"p-4 border-b cursor-pointer hover:bg-gray-50 transition-colors ".concat(a===e.id?"bg-blue-50":""),children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"bg-gray-200 rounded-full h-10 w-10 flex items-center justify-center",children:e.avatar?(0,t.jsx)("img",{src:e.avatar,alt:e.name,className:"rounded-full h-full w-full object-cover"}):(0,t.jsx)("span",{className:"text-gray-500",children:e.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:"font-medium truncate",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-gray-500 truncate",children:e.lastMessage||"Nuevo contacto"})]}),e.unread&&(0,t.jsx)("span",{className:"bg-blue-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:e.unread})]})},e.id))})}z.displayName="Input";var W=a(37255);function H(e){let{...s}=e;return(0,t.jsx)(W.bL,{"data-slot":"dropdown-menu",...s})}function K(e){let{...s}=e;return(0,t.jsx)(W.l9,{"data-slot":"dropdown-menu-trigger",...s})}function G(e){let{className:s,sideOffset:a=4,...r}=e;return(0,t.jsx)(W.ZL,{children:(0,t.jsx)(W.UC,{"data-slot":"dropdown-menu-content",sideOffset:a,className:B("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",s),...r})})}function F(e){let{className:s,inset:a,variant:r="default",...n}=e;return(0,t.jsx)(W.q7,{"data-slot":"dropdown-menu-item","data-inset":a,"data-variant":r,className:B("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...n})}function q(e){let{initialContact:s}=e,{contacts:a,selectedContact:n,messages:l,loading:i,error:o,selectContact:c,sendMessage:m,refreshContacts:x,loadMoreMessages:u}=(0,I.M)(),[h,g]=(0,r.useState)(""),[p,f]=(0,r.useState)(!1),[j,b]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{s&&a.length>0&&a.some(e=>e.id===s)&&C(s)},[s,a]);let y=(0,r.useMemo)(()=>a.filter(e=>{var s;return e.name.toLowerCase().includes(h.toLowerCase())||(null==(s=e.lastMessage)?void 0:s.toLowerCase().includes(h.toLowerCase()))}),[a,h]),w=(0,r.useMemo)(()=>a.find(e=>e.id===n),[a,n]),C=(0,r.useCallback)(async e=>{try{N(!0),await c(e),f(!0)}finally{N(!1)}},[c]),S=(0,r.useCallback)(e=>{g(e.target.value)},[]),T=(0,r.useCallback)(()=>{u()},[u]),R=(0,r.useCallback)(async()=>{try{N(!0),await x()}finally{N(!1)}},[x]),L=(0,r.useCallback)(async e=>{try{N(!0),await m(e)}finally{N(!1)}},[m]);return i?(0,t.jsx)("div",{className:"flex items-center justify-center h-full bg-gray-50",children:(0,t.jsx)(E.A,{className:"animate-spin h-12 w-12 text-blue-500"})}):o?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 text-red-500 p-4",children:[(0,t.jsx)(k.A,{className:"h-12 w-12 mb-4"}),(0,t.jsx)("p",{className:"text-lg font-medium mb-2",children:"Error al cargar conversaciones"}),(0,t.jsx)("p",{className:"text-sm mb-4",children:o}),(0,t.jsx)(d,{variant:"outline",onClick:R,children:"Reintentar"})]}):(0,t.jsxs)("div",{className:"flex h-[calc(100vh-64px)] bg-gray-50",children:[(0,t.jsxs)("div",{className:B("w-full md:w-96 flex flex-col border-r bg-white transition-all duration-300",p?"hidden md:flex":"flex"),children:[(0,t.jsxs)("div",{className:"p-3 border-b sticky top-0 bg-white z-10",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Conversaciones"}),(0,t.jsxs)(H,{onOpenChange:b,children:[(0,t.jsx)(K,{asChild:!0,children:(0,t.jsx)(d,{variant:"ghost",size:"icon",className:B("rounded-full hover:bg-gray-100",j&&"bg-gray-100"),children:(0,t.jsx)(A.A,{className:"h-5 w-5"})})}),(0,t.jsxs)(G,{align:"end",children:[(0,t.jsxs)(F,{onClick:R,disabled:v,children:[v?(0,t.jsx)(E.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(D.A,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Actualizar"})]}),(0,t.jsxs)(F,{children:[(0,t.jsx)(_.A,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Configuraci\xf3n"})]})]})]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(M.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)(z,{placeholder:"Buscar contactos...",className:"pl-9",value:h,onChange:S})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,t.jsx)(U,{contacts:y,selectedContact:n,onSelectContact:C})})]}),(0,t.jsx)("div",{className:B("flex-1 flex flex-col bg-gray-50",p?"flex":"hidden md:flex"),children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-3 border-b bg-white sticky top-0 z-10 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("button",{onClick:()=>f(!1),className:"md:hidden mr-2 p-1 rounded-full hover:bg-gray-100","aria-label":"Volver",children:(0,t.jsx)(O.A,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:(null==w?void 0:w.avatar)?(0,t.jsx)("img",{src:w.avatar,alt:w.name,className:"w-full h-full object-cover"}):(0,t.jsx)("span",{className:"text-gray-600 font-medium",children:null==w?void 0:w.name.charAt(0).toUpperCase()})}),(null==w?void 0:w.isOnline)&&(0,t.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium",children:null==w?void 0:w.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:(null==w?void 0:w.isOnline)?"En l\xednea":"\xdalt. vez ".concat(new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))})]})]})]}),(0,t.jsx)("button",{className:"p-1 rounded-full hover:bg-gray-100",children:(0,t.jsx)(A.A,{className:"h-5 w-5"})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:v?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)(E.A,{className:"animate-spin h-8 w-8 text-gray-400"})}):(0,t.jsx)($,{messages:l,onSendMessage:L,onLoadMore:T,selectedContact:w})})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center px-6",children:[(0,t.jsx)(P.A,{className:"h-12 w-12 mb-4 text-gray-400"}),(0,t.jsx)("h3",{className:"text-lg text-gray-500 font-medium mb-2",children:p?"Volver a conversaciones":"Selecciona una conversaci\xf3n"}),!p&&(0,t.jsx)("p",{className:"text-sm text-gray-400",children:"Elige un contacto para comenzar a chatear"})]})})]})}var V=a(55670),J=a(50741),X=a(84355),Q=a(19663),Z=a(89051),Y=a(24026);let ee=()=>{let[e,s]=(0,r.useState)([]),[a,c]=(0,r.useState)([]),[d,j]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/marketing/insights");if(!e.ok){let s=await e.text();console.error("Error en la solicitud:",s||"Respuesta vac\xeda");return}let a=await e.json();console.log("Datos recibidos:",a),s(a.data),c(a.data)}catch(e){console.error("Error al obtener los datos:",e)}})()},[]);let b=Array.from(new Set(e.map(e=>e.campaignName)));return(0,t.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)("select",{value:d,onChange:s=>{let a=s.target.value;j(a),""===a?c(e):c(e.filter(e=>e.campaignName===a))},className:"p-2 border border-gray-300 rounded",children:[(0,t.jsx)("option",{value:"",children:"Todas las Campa\xf1as"}),b.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})}),(0,t.jsxs)(n,{className:"w-full",children:[(0,t.jsx)(i,{children:(0,t.jsx)(o,{children:"Gr\xe1fico de Rendimiento"})}),(0,t.jsx)(l,{children:(0,t.jsx)(m.u,{width:"100%",height:400,children:(0,t.jsxs)(x.b,{data:a,margin:{top:20,right:30,left:0,bottom:0},children:[(0,t.jsx)(u.d,{strokeDasharray:"3 3"}),(0,t.jsx)(h.W,{dataKey:"campaignName"}),(0,t.jsx)(g.h,{}),(0,t.jsx)(p.m,{}),(0,t.jsx)(Y.s,{}),(0,t.jsx)(f.N,{type:"monotone",dataKey:"spend",stroke:"#8884d8"}),(0,t.jsx)(f.N,{type:"monotone",dataKey:"impressions",stroke:"#82ca9d"}),(0,t.jsx)(f.N,{type:"monotone",dataKey:"clicks",stroke:"#ff7300"})]})})})]}),(0,t.jsxs)(n,{className:"w-full",children:[(0,t.jsx)(i,{children:(0,t.jsx)(o,{children:"M\xe9tricas Detalladas"})}),(0,t.jsx)(l,{children:(0,t.jsx)(Z.FK,{children:(0,t.jsxs)("table",{className:"w-full text-sm text-left text-gray-500",children:[(0,t.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3",children:"Nombre de la Campa\xf1a"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Fecha Inicio"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Fecha Fin"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Gasto"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Impresiones"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Alcance"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Clics"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"CPC"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"CTR"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Frecuencia"})]})}),(0,t.jsx)("tbody",{children:a.map((e,s)=>(0,t.jsxs)("tr",{className:"bg-white border-b hover:bg-gray-100",children:[(0,t.jsx)("td",{className:"px-6 py-4",children:e.campaignName}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.dateStart}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.dateStop}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.spend}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.impressions}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.reach}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.clicks}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.cpc}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.ctr}),(0,t.jsx)("td",{className:"px-6 py-4",children:e.frequency})]},s))})]})})})]})]})};function es(){let[e,s]=(0,r.useState)(null),[a,n]=(0,r.useState)([]),[l,i]=(0,r.useState)(!0),[o,c]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/marketing/account"),a=await e.json();e.ok?(s(a.account),n(a.pages)):(console.error("Error:",a.error),c(a.error||"Error desconocido"))}catch(e){console.error("Error de red:",e),c("Error de red")}finally{i(!1)}})()},[]),l)?(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"Cargando informaci\xf3n de cuenta..."}):o?(0,t.jsxs)("p",{className:"text-red-500 text-sm",children:["Error: ",o]}):(0,t.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Informaci\xf3n de la Cuenta de Marketing"}),e?(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ID:"})," ",e.id]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Nombre:"})," ",e.name]}),e.business_name&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Empresa:"})," ",e.business_name]}),e.created_time&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Creada:"})," ",new Date(e.created_time).toLocaleDateString()]}),e.status&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Estado:"})," ",e.status]})]}):(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"No hay datos de cuenta disponibles."}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"P\xe1ginas Asociadas"}),(0,t.jsx)("ul",{className:"space-y-4",children:Array.isArray(a)&&a.length>0?a.map(e=>(0,t.jsxs)("li",{className:"p-4 border rounded-lg",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Nombre:"})," ",e.name]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ID:"})," ",e.id]}),void 0!==e.fan_count&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Seguidores:"})," ",e.fan_count.toLocaleString()]}),e.category&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Categor\xeda:"})," ",e.category]})]},e.id)):(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"No hay p\xe1ginas disponibles."})})]})}function ea(){let[e,s]=(0,r.useState)([]),[a,n]=(0,r.useState)(!0),[l,i]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/marketing/ads"),a=await e.json();e.ok?s(a.campaigns):i(a.error||"Error al cargar campa\xf1as")}catch(e){console.error(e),i("Error de red")}finally{n(!1)}})()},[]),a)?(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"Cargando campa\xf1as..."}):l?(0,t.jsxs)("p",{className:"text-red-500 text-sm",children:["Error: ",l]}):(0,t.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Campa\xf1as Activas"}),(0,t.jsx)("div",{className:"space-y-4",children:e.length>0?e.map(e=>(0,t.jsxs)("div",{className:"border p-4 rounded-lg",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Nombre:"})," ",e.name]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ID:"})," ",e.id]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Estado:"})," ",e.status]}),e.objective&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Objetivo:"})," ",e.objective]}),e.daily_budget&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Presupuesto Diario:"})," $",(e.daily_budget/100).toFixed(2)]}),e.start_time&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Inicio:"})," ",new Date(e.start_time).toLocaleDateString()]}),e.stop_time&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Fin:"})," ",new Date(e.stop_time).toLocaleDateString()]})]},e.id)):(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"No hay campa\xf1as activas."})})]})}let et=[{name:"Accounts",description:"Gesti\xf3n de cuentas publicitarias",icon:(0,t.jsx)(V.A,{size:40}),component:"AccountManager"},{name:"Ads",description:"Gesti\xf3n de anuncios publicitarios",icon:(0,t.jsx)(J.A,{size:40}),component:"AdsManage"},{name:"Insights",description:"Estad\xedsticas y m\xe9tricas",icon:(0,t.jsx)(X.A,{size:40}),component:"MetricsDashboard"}],er=()=>{let[e,s]=(0,r.useState)(null);return(0,t.jsxs)("div",{className:"p-6 bg-gray-50 min-h-screen",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Marketing"}),e?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("button",{onClick:()=>s(null),className:"flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:[(0,t.jsx)(O.A,{size:18}),"Volver al Dashboard"]}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:(()=>{switch(e){case"AccountManager":return(0,t.jsx)(es,{});case"AdsManage":return(0,t.jsx)(ea,{});case"MetricsDashboard":return(0,t.jsx)(ee,{});default:return null}})()})]}):(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:et.map(e=>(0,t.jsxs)(Q.P.div,{whileHover:{scale:1.03},whileTap:{scale:.98},onClick:()=>s(e.component),className:"cursor-pointer rounded-xl bg-white p-4 shadow-md transition-all hover:shadow-lg",children:[(0,t.jsx)("div",{className:"text-center mb-4",children:e.icon}),(0,t.jsx)("h2",{className:"text-xl font-bold mb-2",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]},e.name))})]})};function en(){let[e,s]=(0,r.useState)("Panelcontrol");return(0,t.jsxs)("div",{className:"flex min-h-screen",children:[(0,t.jsxs)("div",{className:"w-64 bg-gray-800 text-white p-4 flex flex-col",children:[(0,t.jsx)("div",{className:"text-2xl font-bold mb-6 p-2",children:"\uD83D\uDCCA Bdatam CRM"}),(0,t.jsx)("nav",{className:"flex-1 space-y-2",children:[{name:"Panelcontrol",label:"Panel de control"},{name:"Mensajes",label:"Mensajes"},{name:"Leads",label:"Leads"},{name:"Ajustes",label:"Ajustes"},{name:"Marketing",label:"Marketing"}].map(a=>(0,t.jsx)("button",{onClick:()=>s(a.name),className:"w-full text-left p-3 rounded-lg transition-colors ".concat(e===a.name?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-700"),children:a.label},a.name))})]}),(0,t.jsx)("main",{className:"flex-1 overflow-auto bg-gray-50",children:(()=>{switch(e){case"Panelcontrol":default:return(0,t.jsx)(j,{});case"Mensajes":return(0,t.jsx)(q,{});case"Leads":return(0,t.jsx)(b,{});case"Ajustes":return(0,t.jsx)(S,{});case"Marketing":return(0,t.jsx)(er,{})}})()})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[501,268,946,851,884,441,684,358],()=>s(1373)),_N_E=e.O()}]);